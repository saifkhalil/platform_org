{% extends "platform_org/base.html" %}
{% block title %}Workflows{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center pt-3 pb-2 mb-3 border-bottom">
  <h1 class="h2">Dynamic Workflows</h1>
  <div class="btn-group">
    <a class="btn btn-sm btn-primary" href="{% url 'platform_org:workflow_definition_create' %}">New Workflow</a>
    <a class="btn btn-sm btn-outline-primary" href="{% url 'platform_org:workflow_state_create' %}">New State</a>
    <a class="btn btn-sm btn-outline-primary" href="{% url 'platform_org:workflow_transition_create' %}">New Transition</a>
    <a class="btn btn-sm btn-outline-primary" href="{% url 'platform_org:workflow_action_create' %}">New Action</a>
  </div>
</div>

<div class="card shadow-sm">
  <div class="table-responsive">
    <table class="table table-sm align-middle mb-0">
      <thead class="table-light">
        <tr><th>Name</th><th>Entity</th><th>Active</th><th>States</th><th>Transitions</th><th></th></tr>
      </thead>
      <tbody>
        {% for w in items %}
        <tr data-href="{% url 'platform_org:workflow_definition_detail' w.id %}" class="workflow-row" style="cursor:pointer">
          <td>{{ w.name }}</td>
          <td>{{ w.entity_type }}</td>
          <td>{{ w.is_active|yesno:"Yes,No" }}</td>
          <td>{{ w.states.count }}</td>
          <td>{{ w.transitions.count }}</td>
          <td class="text-end">
            <a class="btn btn-sm btn-outline-secondary" href="{% url 'platform_org:workflow_definition_detail' w.id %}" onclick="event.stopPropagation()">Details</a>
            <a class="btn btn-sm btn-outline-primary" href="{% url 'platform_org:workflow_definition_edit' w.id %}" onclick="event.stopPropagation()">Edit</a>
            <a class="btn btn-sm btn-outline-danger" href="{% url 'platform_org:workflow_definition_delete' w.id %}" onclick="event.stopPropagation()">Delete</a>
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="6" class="text-center text-muted py-4">No workflow definitions.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script>
  document.querySelectorAll('.workflow-row').forEach((row) => {
    row.addEventListener('click', () => {
      window.location = row.dataset.href;
    });
  });
</script>
{% endblock %}
