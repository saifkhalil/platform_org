{% extends "platform_org/base.html" %}
{% block title %}Workflow Details{% endblock %}
{% block content %}
<div class="pt-3 pb-2 mb-3 border-bottom">
  <h1 class="h3">Workflow: {{ workflow.name }} <small class="text-muted">({{ workflow.entity_type }})</small></h1>
</div>

<div class="row g-3 mb-3">
  <div class="col-md-6">
    <div class="card"><div class="card-header">Flow Details</div><div class="card-body">
      <ul class="list-group list-group-flush">
        {% for s in states %}
        <li class="list-group-item d-flex justify-content-between">
          <span>{{ s.code }} - {{ s.name }}</span>
          <span class="text-muted">{% if s.is_initial %}Initial{% endif %}{% if s.is_terminal %} Terminal{% endif %}</span>
        </li>
        {% empty %}
        <li class="list-group-item text-muted">No states.</li>
        {% endfor %}
      </ul>
    </div></div>
  </div>
  <div class="col-md-6">
    <div class="card"><div class="card-header">Workflow Chart</div><div class="card-body">
      <pre class="mermaid">{{ mermaid }}</pre>
    </div></div>
  </div>
</div>

<div class="card">
  <div class="card-header">State Actions</div>
  <div class="card-body">
    <table class="table table-sm">
      <thead><tr><th>State</th><th>Name</th><th>Type</th><th>Config</th><th>Active</th></tr></thead>
      <tbody>
      {% for a in actions %}
      <tr>
        <td>{{ a.state.code }}</td><td>{{ a.name }}</td><td>{{ a.action_type }}</td><td><code>{{ a.config }}</code></td><td>{{ a.is_active|yesno:"Yes,No" }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="5" class="text-muted">No actions configured.</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>
<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
  mermaid.initialize({ startOnLoad: true });
</script>
{% endblock %}
